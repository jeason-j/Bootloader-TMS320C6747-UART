#====================================================================================================
# Description:                 Iconv MakeFile
#                              
# Author:                      YanDengxue, Fiberhome-Fuhua
#                              
# History:                     Created at 2011.05.13
#                              
# Version:                     1.00
#
# Rev History:  
#       <Author>        <Data>        <Version>        <Description>
#     YanDengxue       2011-03-22       1.00              Create
#====================================================================================================
#====================================================================================================
# 空格定义
#====================================================================================================
empty:=
space:= $(empty) $(empty)

#====================================================================================================
# 源码路径声明
#====================================================================================================
SRC_DIR =./
LIB_DIR =./
INC_DIR =./
LNK_DIR =./
TEMP_DIR=./
PUBLIC_DIR=./
CFG_DIR =./

#====================================================================================================
# 编译器路径声明
#====================================================================================================
CC=cl6x
AR=ar6x
MK=make
HEX6X=hex6x

#====================================================================================================
# 最终生成对象
#====================================================================================================
DEST_OBJ=IconvData.lib

#====================================================================================================
# 编译对象定义
#====================================================================================================
LIB_OBJS=Utf8.obj Gb2312.obj Windows2512.obj Koi8_u.obj Koi8_r.obj Windows1251.obj IconvData.obj
ABS_LIB_OBJS	:=$(addprefix $(TEMP_DIR),$(LIB_OBJS))

#====================================================================================================
# 命令缩写定义
#====================================================================================================
RM=rm -f
CP=cp

#====================================================================================================
# 参数定义
#====================================================================================================
# INCLUDE_DIR不为当前目录
ifneq "" "$(INC_DIR)"
INCLUDE_SWITCH=-I $(INC_DIR)
endif

# 编译参数
CFLAGS_LOCAL=--gcc --issue_remarks --display_error_number -pdew -c -mv6740 --abi=eabi -O3 $(INCLUDE_SWITCH)
CFLAGS_LOCAL+= -ft $(TEMP_DIR) -fr $(TEMP_DIR)

# 连接参数定义
LINK_FILE = $(LNK_DIR)linker.cmd
LINK_FLAGS  = --abi=eabi -z -c -x
LINK_FLAGS += -I $(C6X_C_DIR)

#====================================================================================================
# 影响所有的.c编译的PREREQUSITE定义
#====================================================================================================
COMPILE_PREREQUSITE_FOR_ALL =$(INC_DIR)*.h Makefile

#====================================================================================================
# 文件依赖定义
#====================================================================================================
all : $(LIB_DIR)$(DEST_OBJ)

$(LIB_DIR)IconvData.lib : $(ABS_LIB_OBJS)
	$(AR) -r $@ $^ 

# 通用对象
$(TEMP_DIR)%.obj  : $(SRC_DIR)%.c $(COMPILE_PREREQUSITE_FOR_ALL)
	$(CC) -fe $@ -c $< $(CFLAGS_LOCAL)

#====================================================================================================
# clean
#====================================================================================================
clean:
	$(RM) $(ABS_LIB_OBJS) $(LIB_DIR)IconvData.lib
