/*****************************************************************************************************
* FileName     :    Windows1251.c
*
* Reference    :    GNU C Library
*
* Description  :    Windows1251解码编码模块
*
* History      :
*       <AUTHOR>        <DATA>        <VERSION>        <DESCRIPTION>
*      YanDengxue     2009-12-19        *.**              Created
*
*****************************************************************************************************/
//====================================================================================================
// 本文件使用的头文件
//====================================================================================================
#include "IconvBase.h"
#include "IconvData.h"

//====================================================================================================
// 本地全局变量
//====================================================================================================
// windows1251 conversion tables.
#pragma DATA_SECTION(__windows1251_from_ucs4_tab1, USER_SLOWDATA)
static const int8 __windows1251_from_ucs4_tab1[] =
{
    [0x00A0 - 0x00A0] = 0xA0,
    [0x00A4 - 0x00A0] = 0xA4,
    [0x00A6 - 0x00A0] = 0xA6,
    [0x00A7 - 0x00A0] = 0xA7,
    [0x00A9 - 0x00A0] = 0xA9,
    [0x00AB - 0x00A0] = 0xAB,
    [0x00AC - 0x00A0] = 0xAC,
    [0x00AD - 0x00A0] = 0xAD,
    [0x00AE - 0x00A0] = 0xAE,
    [0x00B0 - 0x00A0] = 0xB0,
    [0x00B1 - 0x00A0] = 0xB1,
    [0x00B5 - 0x00A0] = 0xB5,
    [0x00B6 - 0x00A0] = 0xB6,
    [0x00B7 - 0x00A0] = 0xB7,
    [0x00BB - 0x00A0] = 0xBB,
};

#pragma DATA_SECTION(__windows1251_from_ucs4_tab2, USER_SLOWDATA)
static const int8 __windows1251_from_ucs4_tab2[] =
{
    [0x0401 - 0x0401] = 0xA8,
    [0x0402 - 0x0401] = 0x80,
    [0x0403 - 0x0401] = 0x81,
    [0x0404 - 0x0401] = 0xAA,
    [0x0405 - 0x0401] = 0xBD,
    [0x0406 - 0x0401] = 0xB2,
    [0x0407 - 0x0401] = 0xAF,
    [0x0408 - 0x0401] = 0xA3,
    [0x0409 - 0x0401] = 0x8A,
    [0x040A - 0x0401] = 0x8C,
    [0x040B - 0x0401] = 0x8E,
    [0x040C - 0x0401] = 0x8D,
    [0x040E - 0x0401] = 0xA1,
    [0x040F - 0x0401] = 0x8F,
    [0x0410 - 0x0401] = 0xC0,
    [0x0411 - 0x0401] = 0xC1,
    [0x0412 - 0x0401] = 0xC2,
    [0x0413 - 0x0401] = 0xC3,
    [0x0414 - 0x0401] = 0xC4,
    [0x0415 - 0x0401] = 0xC5,
    [0x0416 - 0x0401] = 0xC6,
    [0x0417 - 0x0401] = 0xC7,
    [0x0418 - 0x0401] = 0xC8,
    [0x0419 - 0x0401] = 0xC9,
    [0x041A - 0x0401] = 0xCA,
    [0x041B - 0x0401] = 0xCB,
    [0x041C - 0x0401] = 0xCC,
    [0x041D - 0x0401] = 0xCD,
    [0x041E - 0x0401] = 0xCE,
    [0x041F - 0x0401] = 0xCF,
    [0x0420 - 0x0401] = 0xD0,
    [0x0421 - 0x0401] = 0xD1,
    [0x0422 - 0x0401] = 0xD2,
    [0x0423 - 0x0401] = 0xD3,
    [0x0424 - 0x0401] = 0xD4,
    [0x0425 - 0x0401] = 0xD5,
    [0x0426 - 0x0401] = 0xD6,
    [0x0427 - 0x0401] = 0xD7,
    [0x0428 - 0x0401] = 0xD8,
    [0x0429 - 0x0401] = 0xD9,
    [0x042A - 0x0401] = 0xDA,
    [0x042B - 0x0401] = 0xDB,
    [0x042C - 0x0401] = 0xDC,
    [0x042D - 0x0401] = 0xDD,
    [0x042E - 0x0401] = 0xDE,
    [0x042F - 0x0401] = 0xDF,
    [0x0430 - 0x0401] = 0xE0,
    [0x0431 - 0x0401] = 0xE1,
    [0x0432 - 0x0401] = 0xE2,
    [0x0433 - 0x0401] = 0xE3,
    [0x0434 - 0x0401] = 0xE4,
    [0x0435 - 0x0401] = 0xE5,
    [0x0436 - 0x0401] = 0xE6,
    [0x0437 - 0x0401] = 0xE7,
    [0x0438 - 0x0401] = 0xE8,
    [0x0439 - 0x0401] = 0xE9,
    [0x043A - 0x0401] = 0xEA,
    [0x043B - 0x0401] = 0xEB,
    [0x043C - 0x0401] = 0xEC,
    [0x043D - 0x0401] = 0xED,
    [0x043E - 0x0401] = 0xEE,
    [0x043F - 0x0401] = 0xEF,
    [0x0440 - 0x0401] = 0xF0,
    [0x0441 - 0x0401] = 0xF1,
    [0x0442 - 0x0401] = 0xF2,
    [0x0443 - 0x0401] = 0xF3,
    [0x0444 - 0x0401] = 0xF4,
    [0x0445 - 0x0401] = 0xF5,
    [0x0446 - 0x0401] = 0xF6,
    [0x0447 - 0x0401] = 0xF7,
    [0x0448 - 0x0401] = 0xF8,
    [0x0449 - 0x0401] = 0xF9,
    [0x044A - 0x0401] = 0xFA,
    [0x044B - 0x0401] = 0xFB,
    [0x044C - 0x0401] = 0xFC,
    [0x044D - 0x0401] = 0xFD,
    [0x044E - 0x0401] = 0xFE,
    [0x044F - 0x0401] = 0xFF,
    [0x0451 - 0x0401] = 0xB8,
    [0x0452 - 0x0401] = 0x90,
    [0x0453 - 0x0401] = 0x83,
    [0x0454 - 0x0401] = 0xBA,
    [0x0455 - 0x0401] = 0xBE,
    [0x0456 - 0x0401] = 0xB3,
    [0x0457 - 0x0401] = 0xBF,
    [0x0458 - 0x0401] = 0xBC,
    [0x0459 - 0x0401] = 0x9A,
    [0x045A - 0x0401] = 0x9C,
    [0x045B - 0x0401] = 0x9E,
    [0x045C - 0x0401] = 0x9D,
    [0x045E - 0x0401] = 0xA2,
    [0x045F - 0x0401] = 0x9F,
};

#pragma DATA_SECTION(__windows1251_from_ucs4_tab3, USER_SLOWDATA)
static const int8 __windows1251_from_ucs4_tab3[] =
{
    [0x2013 - 0x2013] = 0x96,
    [0x2014 - 0x2013] = 0x97,
    [0x2018 - 0x2013] = 0x91,
    [0x2019 - 0x2013] = 0x92,
    [0x201A - 0x2013] = 0x82,
    [0x201C - 0x2013] = 0x93,
    [0x201D - 0x2013] = 0x94,
    [0x201E - 0x2013] = 0x84,
    [0x2020 - 0x2013] = 0x86,
    [0x2021 - 0x2013] = 0x87,
    [0x2022 - 0x2013] = 0x95,
    [0x2026 - 0x2013] = 0x85,
    [0x2030 - 0x2013] = 0x89,
    [0x2039 - 0x2013] = 0x8B,
    [0x203A - 0x2013] = 0x9B,
};

//====================================================================================================
// 函数实现
//====================================================================================================
//----------------------------------------------------------------------------------------------------
//   Function: Ucs4ToWindows1251
//      Input: Uint32 wch: 待转换的ucs4字符
//             int32 dest_buffer_length: 转换后的buffer最大长度
//     Output: int32 *destination:  转换后的buffer首地址
//     Return: int32: 转换后的字符长度,0标识编码失败,-1程序执行失败
//Description: ucs4编码成Windows1251
//    <AUTHOR>        <MODIFYTIME>            <REASON>
//   YanDengxue     2009-12-19 17:00          Created
//----------------------------------------------------------------------------------------------------
#pragma CODE_SECTION(Ucs4ToWindows1251, USER_SLOWCODE)
int32 Ucs4ToWindows1251(Uint32 wch, int8 *destination, int32 dest_buffer_length)
{
    Uint8 lv_uchar_temp;

    if (NULL == destination)
    {
        return -1;
    }

    if (((Uint32)0x00A0 <= wch) && ((Uint32)0x00BB >= wch))
    {
        lv_uchar_temp = __windows1251_from_ucs4_tab1[wch - 0x00A0];
    }
    else if (((Uint32)0x0401 <= wch) && ((Uint32)0x045F >= wch))
    {
        lv_uchar_temp = __windows1251_from_ucs4_tab2[wch - 0x0401];
    }
    else if (0x0490 == wch)
    {
        lv_uchar_temp = 0xA5;
    }
    else if (0x0491 == wch)
    {
        lv_uchar_temp = 0xB4;
    }
    else if (((Uint32)0x2013 <= wch) && ((Uint32)0x203A >= wch))
    {
        lv_uchar_temp = __windows1251_from_ucs4_tab3[wch - 0x2013];
    }
    else if (0x20AC == wch)
    {
        lv_uchar_temp = 0x88;
    }
    else if (0x2116 == wch)
    {
        lv_uchar_temp = 0xB9;
    }
    else if (0x2122 == wch)
    {
        lv_uchar_temp = 0x99;
    }
    else
    {
        return 0;
    }

    if ('\0' == lv_uchar_temp)
    {
        return 0;
    }

    if (dest_buffer_length < 1)
    {
        return -1;
    }

    destination[0] = lv_uchar_temp;

    return 1;

}



