#====================================================================================================
# Description:                 FH 应用程序 MakeFile
#                              
# Author:                      YanDengxue, Fiberhome-Fuhua
#                              
# History:                     Created at 2011.03.22
#                              
# Version:                     1.00
#
# Rev History:  
#       <Author>        <Data>        <Version>        <Description>
#     YanDengxue       2011-03-22       1.00              Create
#====================================================================================================

#====================================================================================================
# 空格定义
#====================================================================================================
empty:=
space:= $(empty) $(empty)

#====================================================================================================
# 源码路径声明
#====================================================================================================
SRC_DIR =
LIB_DIR =
INC_DIR =
LNK_DIR =
TEMP_DIR=./temp/
PUBLIC_DIR=./pub/

#====================================================================================================
# 编译器路径声明
#====================================================================================================
CC=cl6x
AR=ar6x
MK=make
HEX6X=hex6x

#====================================================================================================
# 最终生成对象
#====================================================================================================
DEST_OBJ=BootEeprom.out

#====================================================================================================
# 编译对象定义
#====================================================================================================
OBJS=Boot.obj HardwareInitial.obj Debug.obj Spi.obj SpiFlash.obj SystemBase.obj

ABS_OBJS	:=$(addprefix $(TEMP_DIR),$(OBJS))
ABS_DEPEND_FILES := $(addprefix $(DEPEND_DIR),$(OBJS:.obj=.d))

#====================================================================================================
# 库声明
#====================================================================================================
LIBS=
ABS_DLBS	:= $(addprefix $(LIB_DIR),$(LIBS))

#====================================================================================================
# 命令缩写定义
#====================================================================================================
RM=rm -f
CP=cp

#====================================================================================================
# 参数定义
#====================================================================================================
# INCLUDE_DIR不为当前目录
ifneq "" "$(INC_DIR)"
INCLUDE_SWITCH=-I $(INC_DIR)
endif

# 编译参数
CFLAGS_LOCAL=--gcc --issue_remarks --display_error_number -pdew -c -mv6740 --abi=eabi -O3 $(INCLUDE_SWITCH)
CFLAGS_LOCAL+= -ft $(TEMP_DIR) -fr $(TEMP_DIR)

# 连接参数定义
LINK_FILE = $(LNK_DIR)linker.cmd
LINK_FLAGS  = --abi=eabi -z -cr -x
LINK_FLAGS += -I $(C6X_C_DIR)

#====================================================================================================
# 影响所有的.c编译的PREREQUSITE定义
#====================================================================================================
COMPILE_PREREQUSITE_FOR_ALL =$(INC_DIR)*.h

#====================================================================================================
# 文件依赖定义
#====================================================================================================
all : $(PUBLIC_DIR)$(DEST_OBJ)

# TEMP_DIR不为空
ifneq "" "$(TEMP_DIR)"
$(OBJS)  : %.obj:$(TEMP_DIR)%.o#保证可以不带路径可以直接编译
endif

$(PUBLIC_DIR)$(DEST_OBJ) : $(ABS_OBJS) $(ABS_DLBS) $(LINK_FILE)
	$(CC) $(LINK_FLAGS) $^ -o $@ -m $(@:.out=.map)

# 通用对象
$(TEMP_DIR)%.obj  : $(SRC_DIR)%.c $(COMPILE_PREREQUSITE_FOR_ALL)
	$(CC) -fe $@ -c $< $(CFLAGS_LOCAL)

#====================================================================================================
# clean
#====================================================================================================
clean : 
	$(RM) $(ABS_OBJS) $(PUBLIC_DIR)$(DEST_OBJ:.out=.map) $(PUBLIC_DIR)$(DEST_OBJ)

